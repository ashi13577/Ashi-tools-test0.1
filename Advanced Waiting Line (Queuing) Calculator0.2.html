<!DOCTYPE html>
<html>
<head>
            <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SFBS0EZSPT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SFBS0EZSPT');
</script>
            <style></style>
        </head>
        <body data-new-gr-c-s-check-loaded="14.1240.0" data-gr-ext-installed="">
            


  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Waiting Line (Queuing) Calculator - Ashi Tools</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --secondary: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark-bg: #1e293b;
      --card-bg: #1f2937;
      --text-light: #f3f4f6;
      --text-secondary: #9ca3af;
      --border-light: rgba(156, 163, 175, 0.2);
      --success: #22c55e;
      --purple: #8b5cf6;
      --orange: #f97316;
      --teal: #14b8a6;
      --rose: #f43f5e;
      --indigo: #6366f1;
    }
    
    body {
      font-family: Roboto, sans-serif;
      background: linear-gradient(135deg, #1e293b, #0f172a);
      color: var(--text-light);
      margin: 0;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 30px auto 0 auto;
      background: linear-gradient(145deg, #1f2937, #111827);
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.32);
      overflow: hidden;
      border: 1px solid var(--border-light);
    }
    
    .header {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      color: white;
      padding: 30px;
      text-align: center;
      border-bottom: 1px solid var(--border-light);
    }
    
    .header h1 {
      font-size: 2.2em;
      margin: 0 0 5px 0;
      color: #fff;
    }
    
    .header p {
      margin: 0 auto;
      font-size: 1.1em;
      color: #e0e7ef;
      max-width: 800px;
    }
    
    .main-section {
      padding: 36px 28px 32px 28px;
      min-height: 350px;
    }
    
    .queue-form {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 36px;
      box-shadow: 0 3px 18px rgba(0,0,0,.21);
      border: 1px solid var(--border-light);
    }
    
    .queue-form .row {
      display: flex;
      flex-wrap: wrap;
      gap: 18px;
      margin-bottom: 14px;
    }
    
    .form-group {
      flex: 1;
      min-width: 200px;
      display: flex;
      flex-direction: column;
      margin-bottom: 8px;
    }
    
    .form-group label {
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--indigo);
      letter-spacing: .01em;
    }
    
    .form-group input, .form-group select, .form-group textarea {
      padding: 10px 12px;
      border-radius: 7px;
      border: 2px solid var(--border-light);
      background: rgba(55,65,80,0.30);
      color: var(--text-light);
      font-size: 1em;
      margin-bottom: 2px;
      font-family: inherit;
      transition: border-color 0.3s ease;
    }
    
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none;
      border-color: var(--indigo);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    .form-actions {
      display: flex;
      gap: 18px;
      margin: 10px 0 0 0;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 11px 24px;
      border: none;
      border-radius: 22px;
      background: var(--indigo);
      color: #fff;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all .23s ease;
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }
    
    .btn:hover { 
      background: #4f46e5; 
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-secondary { background: var(--secondary);}
    .btn-secondary:hover { background: #047857; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);}
    .btn-warning { background: var(--warning);}
    .btn-warning:hover { background: #ca8a04; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);}
    .btn-danger { background: var(--danger);}
    .btn-danger:hover { background: #dc2626; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);}
    .btn-orange { background: var(--orange);}
    .btn-orange:hover { background: #ea580c; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);}
    .btn-purple { background: var(--purple);}
    .btn-purple:hover { background: #7c3aed; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);}
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn i { font-size: 1.09em;}
    .input-hint { 
      font-size: 12px; 
      color: var(--text-secondary);
      margin-top: 2px;
    }
    
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin: 24px 0;
    }
    
    .result-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--border-light);
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .result-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    
    .result-card.wait-time {
      border-color: var(--indigo);
      background: rgba(99, 102, 241, 0.1);
    }
    
    .result-card.queue-length {
      border-color: var(--purple);
      background: rgba(139, 92, 246, 0.1);
    }
    
    .result-card.utilization {
      border-color: var(--orange);
      background: rgba(249, 115, 22, 0.1);
    }
    
    .result-card.efficiency {
      border-color: var(--success);
      background: rgba(34, 197, 94, 0.1);
    }
    
    .result-card.critical {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }
    
    .result-value {
      font-size: 2.2em;
      font-weight: 700;
      margin-bottom: 8px;
      animation: countUp 0.8s ease-out;
    }
    
    @keyframes countUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .result-card.wait-time .result-value { color: var(--indigo); }
    .result-card.queue-length .result-value { color: var(--purple); }
    .result-card.utilization .result-value { color: var(--orange); }
    .result-card.efficiency .result-value { color: var(--success); }
    .result-card.critical .result-value { color: var(--danger); }
    .result-card .result-value { color: var(--indigo); }
    
    .result-label {
      color: var(--text-secondary);
      font-size: 0.9em;
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    .result-sublabel {
      color: var(--text-secondary);
      font-size: 0.8em;
    }
    
    .queue-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card-bg);
      border-radius: 10px;
      overflow: hidden;
      margin-top: 14px;
      font-size: 15px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .queue-table th, .queue-table td {
      border-bottom: 1px solid #283447;
      padding: 12px 10px;
      text-align: center;
    }
    
    .queue-table th {
      background: #232d3b;
      color: var(--indigo);
      font-weight: 500;
      position: relative;
    }
    
    .queue-table td {
      color: var(--text-light);
      background: var(--card-bg);
      transition: background-color 0.2s ease;
    }
    
    .queue-table tr:hover td {
      background: rgba(55,65,80,0.5);
    }
    
    .chart-container {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 22px 16px 20px 16px;
      margin: 20px 0;
      border: 1px solid var(--border-light);
      min-height: 400px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 24px 0 16px 0;
      color: var(--indigo);
      font-size: 1.3em;
      font-weight: 600;
    }
    
    .feature-tag {
      background: #22304c;
      color: #93c5fd;
      font-size: 11px;
      border-radius: 11px;
      padding: 4px 12px;
      margin-right: 6px;
      font-weight: 500;
      display: inline-block;
    }
    
    .queue-parameters {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      margin: 24px 0;
      border: 1px solid var(--border-light);
    }
    
    .parameter-input {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin: 16px 0;
    }
    
    .parameter-item {
      background: rgba(55,65,80,0.20);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border-light);
      transition: border-color 0.3s ease;
    }
    
    .parameter-item:hover {
      border-color: var(--indigo);
    }
    
    .parameter-item label {
      font-size: 0.9em;
      color: var(--indigo);
      font-weight: 500;
      display: block;
      margin-bottom: 4px;
    }
    
    .scenario-section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      margin: 24px 0;
      border: 1px solid var(--border-light);
    }
    
    .scenario-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .scenario-card {
      background: rgba(55,65,80,0.30);
      border-radius: 8px;
      padding: 16px;
      border: 1px solid var(--border-light);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .scenario-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .scenario-card.best {
      border-color: var(--success);
      background: rgba(34, 197, 94, 0.1);
    }
    
    .scenario-card.worst {
      border-color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }
    
    .scenario-title {
      font-weight: 600;
      color: var(--indigo);
      margin-bottom: 8px;
      font-size: 1.1em;
    }
    
    .scenario-card.best .scenario-title {
      color: var(--success);
    }
    
    .scenario-card.worst .scenario-title {
      color: var(--danger);
    }
    
    .education-box {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 25px 18px;
      margin-bottom: 26px;
      border: 1px solid var(--border-light);
      color: var(--text-secondary);
      line-height: 1.6;
    }
    
    .education-box h3, .education-box h4 {
      color: var(--indigo); 
      font-weight: 700;
      margin-bottom: 12px;
    }
    
    .formula {
      padding: 12px 16px;
      font-family: 'Courier New', monospace;
      border-radius: 8px; 
      background: #22304c;
      margin: 12px 0; 
      color: #a7d2fe;
      font-size: 1.1em;
      display: inline-block;
      border-left: 4px solid var(--indigo);
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--secondary);
      color: #fff;
      padding: 16px 30px;
      border-radius: 10px;
      display: none;
      z-index: 1102;
      font-size: 1em;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(0,0,0,0.19);
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .toast.success { background: var(--secondary);}
    .toast.error { background: var(--danger);}
    .toast.warning { background: var(--warning);}
    
    .queue-status {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
      margin: 8px 0;
      display: inline-block;
    }
    
    .queue-status.stable {
      background: rgba(34, 197, 94, 0.2);
      color: var(--success);
    }
    
    .queue-status.unstable {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }
    
    .queue-status.critical {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning);
    }
    
    .loading-spinner {
      border: 3px solid var(--border-light);
      border-top: 3px solid var(--indigo);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(55,65,80,0.5);
      border-radius: 3px;
      overflow: hidden;
      margin: 8px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--indigo), var(--purple));
      border-radius: 3px;
      transition: width 0.3s ease;
    }
    
    .template-section {
      margin-bottom: 20px;
    }
    
    .template-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    
    .validation-error {
      color: var(--danger);
      font-size: 0.8em;
      margin-top: 4px;
      display: none;
    }
    
    .input-group {
      position: relative;
    }
    
    .input-group.error input {
      border-color: var(--danger);
    }
    
    .input-group.error .validation-error {
      display: block;
    }
    
    footer {
      text-align: center;
      color: var(--text-secondary);
      margin-top: 40px;
      padding: 30px;
      line-height: 1.6;
      background: linear-gradient(145deg, #1f2937, #111827);
      border-top: 1px solid var(--border-light);
    }
    
    .insta-link {
      color: #e1306c;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s ease;
      background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .insta-link:hover {
      transform: scale(1.05);
    }
    
    @media (max-width:800px) {
      .main-section { padding:19px 5vw;}
      .chart-container, .education-box, .queue-form {padding: 14px 5vw;}
      .results-grid { grid-template-columns: 1fr;}
      .parameter-input { grid-template-columns: 1fr;}
      .template-buttons { justify-content: center; }
      .form-actions { justify-content: center; }
      .btn { min-width: 140px; justify-content: center; }
    }
  </style>


  <div class="container">
    <div class="header">
      <h1><i class="fa-solid fa-people-line"></i> Advanced Waiting Line (Queuing) Calculator</h1>
      <p>
        Comprehensive queuing theory analysis with multiple queue models, performance optimization, and service level management.<br>
        Calculate wait times, queue lengths, system utilization, and optimize service operations for maximum efficiency.
      </p>
    </div>
    <div class="main-section">

      <!-- Main Queuing Form -->
      <div class="queue-form">
        <div class="template-section">
          <h3 style="color:var(--indigo);margin-bottom:16px;"><i class="fa-solid fa-rocket"></i> Quick Start Templates</h3>
          <div class="template-buttons">
            <button class="btn btn-secondary" onclick="loadTemplate('bank_teller')">
              <i class="fa-solid fa-building-columns"></i> Bank Teller
            </button>
            <button class="btn btn-secondary" onclick="loadTemplate('call_center')">
              <i class="fa-solid fa-headset"></i> Call Center
            </button>
            <button class="btn btn-secondary" onclick="loadTemplate('restaurant')">
              <i class="fa-solid fa-utensils"></i> Restaurant
            </button>
            <button class="btn btn-secondary" onclick="loadTemplate('hospital_er')">
              <i class="fa-solid fa-hospital"></i> Hospital ER
            </button>
            <button class="btn btn-secondary" onclick="loadTemplate('drive_thru')">
              <i class="fa-solid fa-car"></i> Drive-Thru
            </button>
          </div>
        </div>
        
        <div class="row">
          <div class="form-group">
            <label>Queue Model Type</label>
            <select id="queueModel">
              <option value="M/M/1">M/M/1 (Single Server)</option>
              <option value="M/M/c">M/M/c (Multiple Servers)</option>
              <option value="M/M/1/K">M/M/1/K (Single Server, Limited Capacity)</option>
              <option value="M/M/c/K">M/M/c/K (Multiple Servers, Limited Capacity)</option>
              <option value="M/G/1">M/G/1 (Single Server, General Service)</option>
            </select>
            <span class="input-hint">Kendall notation for queue classification</span>
          </div>
          <div class="form-group">
            <label>Business Type</label>
            <select id="businessType">
              <option value="bank">Banking/Financial</option>
              <option value="retail">Retail/Shopping</option>
              <option value="healthcare">Healthcare</option>
              <option value="restaurant">Food Service</option>
              <option value="government">Government Office</option>
              <option value="call_center">Call Center</option>
            </select>
          </div>
          <div class="form-group">
            <label>Time Unit</label>
            <select id="timeUnit">
              <option value="minutes">Minutes</option>
              <option value="hours">Hours</option>
              <option value="seconds">Seconds</option>
            </select>
          </div>
        </div>

        <!-- Queue Parameters -->
        <div class="queue-parameters">
          <h4 style="color: var(--indigo); margin-bottom: 16px;"><i class="fa-solid fa-sliders"></i> Queue Parameters</h4>
          <div class="parameter-input">
            <div class="parameter-item">
              <label>Arrival Rate (λ)</label>
              <div class="input-group">
                <input id="arrivalRate" type="number" value="20" step="0.1" min="0.1" title="Average number of customers arriving per time unit">
                <span class="validation-error">Must be greater than 0</span>
              </div>
              <span class="input-hint">Customers per time unit</span>
            </div>
            <div class="parameter-item">
              <label>Service Rate (μ)</label>
              <div class="input-group">
                <input id="serviceRate" type="number" value="25" step="0.1" min="0.1" title="Average number of customers that can be served per time unit">
                <span class="validation-error">Must be greater than arrival rate for stability</span>
              </div>
              <span class="input-hint">Customers served per time unit</span>
            </div>
            <div class="parameter-item" id="serverCountGroup" style="display: none;">
              <label>Number of Servers (c)</label>
              <div class="input-group">
                <input id="serverCount" type="number" value="1" min="1" max="20" title="Number of parallel service channels available">
                <span class="validation-error">Must be between 1 and 20</span>
              </div>
              <span class="input-hint">Parallel service channels</span>
            </div>
            <div class="parameter-item" id="capacityGroup" style="display: none;">
              <label>System Capacity (K)</label>
              <div class="input-group">
                <input id="systemCapacity" type="number" value="50" min="1" title="Maximum number of customers the system can hold">
                <span class="validation-error">Must be greater than 0</span>
              </div>
              <span class="input-hint">Maximum customers in system</span>
            </div>
            <div class="parameter-item" id="varianceGroup" style="display:none;">
              <label>Service Time Variance</label>
              <div class="input-group">
                <input id="serviceVariance" type="number" value="1" step="0.1" min="0" title="Variability in service times (used in M/G/1 model)">
                <span class="validation-error">Must be non-negative</span>
              </div>
              <span class="input-hint">For M/G/1 model</span>
            </div>
            <div class="parameter-item">
              <label>Cost per Wait ($/unit time)</label>
              <div class="input-group">
                <input id="waitingCost" type="number" value="0.50" step="0.01" min="0" title="Cost associated with each customer waiting per time unit">
                <span class="validation-error">Must be non-negative</span>
              </div>
              <span class="input-hint">Customer waiting time cost</span>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="form-group">
            <label>Service Level Target (%)</label>
            <div class="input-group">
              <input id="serviceLevelTarget" type="number" value="95" min="50" max="99.9" step="0.1" title="Desired percentage of customers served within acceptable time">
              <span class="validation-error">Must be between 50% and 99.9%</span>
            </div>
            <span class="input-hint">Target percentage served within acceptable time</span>
          </div>
          <div class="form-group">
            <label>Acceptable Wait Time</label>
            <div class="input-group">
              <input id="acceptableWaitTime" type="number" value="5" step="0.1" min="0" title="Maximum wait time considered acceptable">
              <span class="validation-error">Must be non-negative</span>
            </div>
            <span class="input-hint">Maximum acceptable wait time</span>
          </div>
          <div class="form-group">
            <label>Server Cost ($/hour)</label>
            <div class="input-group">
              <input id="serverCost" type="number" value="25" step="0.01" min="0" title="Hourly operational cost per server">
              <span class="validation-error">Must be non-negative</span>
            </div>
            <span class="input-hint">Hourly cost per server</span>
          </div>
        </div>

        <div class="form-actions">
          <button class="btn" id="calculateBtn" onclick="calculateQueue()">
            <i class="fa-solid fa-calculator"></i> Analyze Queue System
          </button>
          <button class="btn btn-orange" onclick="optimizeServers()">
            <i class="fa-solid fa-chart-line"></i> Optimize Servers
          </button>
          <button class="btn btn-purple" onclick="sensitivityAnalysis()">
            <i class="fa-solid fa-microscope"></i> Sensitivity Analysis
          </button>
          <button class="btn btn-secondary" onclick="exportResults()">
            <i class="fa-solid fa-download"></i> Export Results
          </button>
          <button class="btn btn-warning" onclick="resetForm()">
            <i class="fa-solid fa-rotate-left"></i> Reset
          </button>
        </div>
      </div>

      <!-- Results Section -->
      <div id="resultsSection" style="display: none;">
        
        <!-- Key Metrics -->
        <div class="section-header">
          <i class="fa-solid fa-chart-pie"></i>
          <span>Queue Performance Metrics</span>
        </div>
        <div class="results-grid" id="metricsGrid">
        <div class="result-card wait-time">
          <div class="result-value">0.03</div>
          <div class="result-label">Average Wait Time</div>
          <div class="result-sublabel">Time in queue (minutes)</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 0.3078593060167111%"></div>
          </div>
        </div>
        <div class="result-card queue-length">
          <div class="result-value">1.39</div>
          <div class="result-label">Average Queue Length</div>
          <div class="result-sublabel">Customers waiting</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 6.926834385375999%"></div>
          </div>
        </div>
        <div class="result-card utilization">
          <div class="result-value">75.0%</div>
          <div class="result-label">System Utilization</div>
          <div class="result-sublabel">Server busy time</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 75%"></div>
          </div>
        </div>
        <div class="result-card efficiency">
          <div class="result-value">100.0%</div>
          <div class="result-label">Service Level</div>
          <div class="result-sublabel">Within target time</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 99.99999999999568%"></div>
          </div>
        </div>
      </div>

        <!-- Queue Status -->
        <div id="queueStatus">
        <div class="queue-status stable">
          <i class="fa-solid fa-check-circle"></i>
          ✅ Stable System | Traffic Intensity (ρ) = 0.750
          
        </div>
      </div>

        <!-- Performance Chart -->
        <div class="chart-container">
          <canvas id="queueChart" style="box-sizing: border-box;" width="300"></canvas>
        </div>

        <!-- Detailed Results Table -->
        <div class="section-header">
          <i class="fa-solid fa-table"></i>
          <span>Detailed Queue Analysis</span>
        </div>
        <div style="overflow-x:auto;">
          <table class="queue-table" id="queueTable">
        <tbody><tr>
          <th><i class="fa-solid fa-cog"></i> Performance Metric</th>
          <th><i class="fa-solid fa-calculator"></i> Value</th>
          <th><i class="fa-solid fa-ruler"></i> Unit</th>
          <th><i class="fa-solid fa-info-circle"></i> Description</th>
        </tr>
        <tr>
          <td><strong>Queue Model</strong></td>
          <td><span class="feature-tag">M/M/c</span></td>
          <td>-</td>
          <td>Kendall notation classification</td>
        </tr>
        <tr>
          <td><strong>Traffic Intensity (ρ)</strong></td>
          <td>0.7500</td>
          <td>ratio</td>
          <td>System utilization ratio</td>
        </tr>
        <tr>
          <td><strong>Average Wait Time (Wq)</strong></td>
          <td>0.031</td>
          <td>minutes</td>
          <td>Expected time in queue</td>
        </tr>
        <tr>
          <td><strong>Average System Time (W)</strong></td>
          <td>0.114</td>
          <td>minutes</td>
          <td>Total time in system</td>
        </tr>
        <tr>
          <td><strong>Average Queue Length (Lq)</strong></td>
          <td>1.385</td>
          <td>customers</td>
          <td>Expected customers waiting</td>
        </tr>
        <tr>
          <td><strong>Average System Length (L)</strong></td>
          <td>5.135</td>
          <td>customers</td>
          <td>Expected customers in system</td>
        </tr>
        <tr>
          <td><strong>Idle Probability (P₀)</strong></td>
          <td>1.87%</td>
          <td>probability</td>
          <td>System empty probability</td>
        </tr>
        <tr>
          <td><strong>Service Level</strong></td>
          <td>100.00%</td>
          <td>percentage</td>
          <td>Served within target time</td>
        </tr>
        <tr>
          <td><strong>Total Cost</strong></td>
          <td>$141.56</td>
          <td>per hour</td>
          <td>Waiting + server costs</td>
        </tr>
        <tr>
          <td><strong>Number of Servers</strong></td>
          <td>5</td>
          <td>servers</td>
          <td>Active service channels</td>
        </tr>
      </tbody></table>
        </div>
      </div>

      <!-- Server Optimization Section -->
      <div class="scenario-section" id="optimizationSection" style="display: none;">
        <h3 style="color: var(--indigo);"><i class="fa-solid fa-chart-line"></i> Server Optimization Analysis</h3>
        <div class="scenario-grid" id="optimizationGrid">
        <div class="scenario-card ">
          <div class="scenario-title">
            5 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $141.56/hr</div>
          <div><strong>Wait Time:</strong> 0.03 min</div>
          <div><strong>Queue Length:</strong> 1.39</div>
          <div><strong>Utilization:</strong> 75.0%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card best">
          <div class="scenario-title">
            6 Servers 
            🏆 OPTIMAL
          </div>
          <div><strong>Total Cost:</strong> $131.37/hr</div>
          <div><strong>Wait Time:</strong> 0.01 min</div>
          <div><strong>Queue Length:</strong> 0.38</div>
          <div><strong>Utilization:</strong> 62.5%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card ">
          <div class="scenario-title">
            7 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $143.56/hr</div>
          <div><strong>Wait Time:</strong> 0.00 min</div>
          <div><strong>Queue Length:</strong> 0.12</div>
          <div><strong>Utilization:</strong> 53.6%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card ">
          <div class="scenario-title">
            8 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $161.13/hr</div>
          <div><strong>Wait Time:</strong> 0.00 min</div>
          <div><strong>Queue Length:</strong> 0.04</div>
          <div><strong>Utilization:</strong> 46.9%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card ">
          <div class="scenario-title">
            9 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $180.35/hr</div>
          <div><strong>Wait Time:</strong> 0.00 min</div>
          <div><strong>Queue Length:</strong> 0.01</div>
          <div><strong>Utilization:</strong> 41.7%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card ">
          <div class="scenario-title">
            10 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $200.10/hr</div>
          <div><strong>Wait Time:</strong> 0.00 min</div>
          <div><strong>Queue Length:</strong> 0.00</div>
          <div><strong>Utilization:</strong> 37.5%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card ">
          <div class="scenario-title">
            11 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $220.03/hr</div>
          <div><strong>Wait Time:</strong> 0.00 min</div>
          <div><strong>Queue Length:</strong> 0.00</div>
          <div><strong>Utilization:</strong> 34.1%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card ">
          <div class="scenario-title">
            12 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $240.01/hr</div>
          <div><strong>Wait Time:</strong> 0.00 min</div>
          <div><strong>Queue Length:</strong> 0.00</div>
          <div><strong>Utilization:</strong> 31.3%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card ">
          <div class="scenario-title">
            13 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $260.00/hr</div>
          <div><strong>Wait Time:</strong> 0.00 min</div>
          <div><strong>Queue Length:</strong> 0.00</div>
          <div><strong>Utilization:</strong> 28.8%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card ">
          <div class="scenario-title">
            14 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $280.00/hr</div>
          <div><strong>Wait Time:</strong> 0.00 min</div>
          <div><strong>Queue Length:</strong> 0.00</div>
          <div><strong>Utilization:</strong> 26.8%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      
        <div class="scenario-card ">
          <div class="scenario-title">
            15 Servers 
            
          </div>
          <div><strong>Total Cost:</strong> $300.00/hr</div>
          <div><strong>Wait Time:</strong> 0.00 min</div>
          <div><strong>Queue Length:</strong> 0.00</div>
          <div><strong>Utilization:</strong> 25.0%</div>
          <div><strong>Service Level:</strong> 100.0%</div>
          <div><strong>Status:</strong> ✅ Stable</div>
        </div>
      </div>
        <div class="chart-container">
          <canvas id="optimizationChart" style="box-sizing: border-box;" width="300"></canvas>
        </div>
      </div>

      <!-- Sensitivity Analysis Section -->
      <div class="scenario-section" id="sensitivitySection" style="display: none;">
        <h3 style="color: var(--indigo);"><i class="fa-solid fa-microscope"></i> Sensitivity Analysis</h3>
        <div class="scenario-grid" id="sensitivityGrid">
          <div class="scenario-card best">
            <div class="scenario-title">
              📉 Low Demand (-30%) 
              🏆 BEST
            </div>
            <div><strong>Status:</strong> ✅ Stable</div>
            <div><strong>Utilization:</strong> 52.5%</div>
            <div><strong>Wait Time:</strong> 0.01 min</div>
            <div><strong>Queue Length:</strong> 0.17</div>
            <div><strong>Total Cost:</strong> $105.09/hr</div>
            <div style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary); font-style: italic;">
              30% reduction in arrival rate
            </div>
          </div>
        
          <div class="scenario-card ">
            <div class="scenario-title">
              📊 Low Demand (-20%) 
              
            </div>
            <div><strong>Status:</strong> ✅ Stable</div>
            <div><strong>Utilization:</strong> 60.0%</div>
            <div><strong>Wait Time:</strong> 0.01 min</div>
            <div><strong>Queue Length:</strong> 0.35</div>
            <div><strong>Total Cost:</strong> $110.63/hr</div>
            <div style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary); font-style: italic;">
              20% reduction in arrival rate
            </div>
          </div>
        
          <div class="scenario-card ">
            <div class="scenario-title">
              📊 Current Scenario 
              
            </div>
            <div><strong>Status:</strong> ✅ Stable</div>
            <div><strong>Utilization:</strong> 75.0%</div>
            <div><strong>Wait Time:</strong> 0.03 min</div>
            <div><strong>Queue Length:</strong> 1.39</div>
            <div><strong>Total Cost:</strong> $141.56/hr</div>
            <div style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary); font-style: italic;">
              Current baseline scenario
            </div>
          </div>
        
          <div class="scenario-card worst">
            <div class="scenario-title">
              📈 High Demand (+20%) 
              ⚠️ WORST
            </div>
            <div><strong>Status:</strong> ✅ Stable</div>
            <div><strong>Utilization:</strong> 90.0%</div>
            <div><strong>Wait Time:</strong> 0.13 min</div>
            <div><strong>Queue Length:</strong> 6.86</div>
            <div><strong>Total Cost:</strong> $305.87/hr</div>
            <div style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary); font-style: italic;">
              20% increase in arrival rate
            </div>
          </div>
        
          <div class="scenario-card ">
            <div class="scenario-title">
              🚀 Peak Demand (+50%) 
              
            </div>
            <div><strong>Status:</strong> ❌ Unstable</div>
            <div><strong>Utilization:</strong> ∞%</div>
            <div><strong>Wait Time:</strong> ∞ min</div>
            <div><strong>Queue Length:</strong> ∞</div>
            <div><strong>Total Cost:</strong> $∞/hr</div>
            <div style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary); font-style: italic;">
              Peak period traffic surge
            </div>
          </div>
        
          <div class="scenario-card ">
            <div class="scenario-title">
              ⚡ Improved Service (+25%) 
              
            </div>
            <div><strong>Status:</strong> ✅ Stable</div>
            <div><strong>Utilization:</strong> 60.0%</div>
            <div><strong>Wait Time:</strong> 0.01 min</div>
            <div><strong>Queue Length:</strong> 0.35</div>
            <div><strong>Total Cost:</strong> $110.63/hr</div>
            <div style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary); font-style: italic;">
              Service rate improvement
            </div>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="sensitivityChart" style="box-sizing: border-box;" width="300"></canvas>
        </div>
      </div>

      <!-- Learning Panel -->
      <div class="education-box">
        <h3><i class="fa-solid fa-graduation-cap"></i> Queuing Theory - Mathematical Foundation</h3>
        <div style="margin-bottom:12px;">
          <b>Master queuing theory to optimize service operations, reduce wait times, and improve customer satisfaction through mathematical modeling.</b>
        </div>
        
        <h4>1. Traffic Intensity (ρ) <span class="feature-tag">Core Metric</span><span class="feature-tag">Stability</span></h4>
        <div class="formula">ρ = λ / (c × μ)</div>
        <div>System utilization ratio. Must be &lt; 1 for system stability. Higher ρ means longer queues and wait times.</div>
        
        <h4>2. Average Wait Time in Queue (Wq) <span class="feature-tag">M/M/1 Model</span></h4>
        <div class="formula">Wq = λ / (μ × (μ - λ))</div>
        <div>Expected time a customer waits before being served (excluding service time).</div>
        
        <h4>3. Average Queue Length (Lq) <span class="feature-tag">Little's Law</span></h4>
        <div class="formula">Lq = λ × Wq</div>
        <div>Expected number of customers waiting in queue (not including those being served).</div>
        
        <h4>4. Total System Time (W) <span class="feature-tag">Complete Experience</span></h4>
        <div class="formula">W = Wq + (1/μ)</div>
        <div>Total time customer spends in system (waiting + service time).</div>
        
        <h4>5. Probability of n Customers (M/M/1) <span class="feature-tag">Steady State</span></h4>
        <div class="formula">P(n) = ρⁿ × (1 - ρ)</div>
        <div>Probability of finding exactly n customers in the system at any given time.</div>
        
        <h4>Queue Models (Kendall Notation: A/B/c/K/N/D)</h4>
        <ul>
          <li><b>M/M/1:</b> Poisson arrivals, exponential service, single server, infinite capacity</li>
          <li><b>M/M/c:</b> Multiple servers with identical service rates</li>
          <li><b>M/M/1/K:</b> Single server with limited system capacity K</li>
          <li><b>M/M/c/K:</b> Multiple servers with limited capacity</li>
          <li><b>M/G/1:</b> General service time distribution (not necessarily exponential)</li>
        </ul>
        
        <h4>Key Performance Indicators</h4>
        <ul>
          <li><b>Utilization (ρ):</b> Percentage of time servers are busy</li>
          <li><b>Average Wait Time:</b> Expected time in queue before service</li>
          <li><b>Service Level:</b> Percentage served within target time</li>
          <li><b>Queue Length:</b> Average and maximum number waiting</li>
          <li><b>System Throughput:</b> Effective arrival rate λₑ</li>
        </ul>
        
        <h4>Optimization Strategies</h4>
        <ul>
          <li><b>Server Optimization:</b> Find optimal number of servers minimizing total cost</li>
          <li><b>Service Rate Improvement:</b> Invest in faster service processes</li>
          <li><b>Demand Management:</b> Smooth arrival patterns through scheduling</li>
          <li><b>Queue Discipline:</b> FIFO, Priority queues, Shortest Job First</li>
          <li><b>Capacity Management:</b> Balking and reneging consideration</li>
        </ul>
        
        <h4>Business Applications</h4>
        <ul>
          <li><b>Banking:</b> Teller staffing, ATM placement, loan processing</li>
          <li><b>Healthcare:</b> Emergency department, appointment scheduling, bed management</li>
          <li><b>Retail:</b> Checkout optimization, customer service, warehouse operations</li>
          <li><b>Manufacturing:</b> Production line balancing, machine maintenance scheduling</li>
          <li><b>Technology:</b> Server capacity planning, call center staffing, help desk</li>
        </ul>
        
        <h4>Cost-Benefit Analysis</h4>
        <ul>
          <li>Balance customer waiting costs vs. service capacity costs</li>
          <li>Consider customer satisfaction and retention impacts</li>
          <li>Evaluate revenue loss from balking (customers leaving)</li>
          <li>Optimize service level agreements and performance targets</li>
          <li>Factor in peak vs. off-peak demand variations</li>
        </ul>
      </div>

    </div><!-- main-section -->

    <!-- Toast -->
    <div class="toast success" id="toast" style="display: block;">Form reset successfully!</div>
    <footer>
      Built with ❤️ by Ashi | Empowering tomorrow's management leaders<br>
      Connect: 
      <a class="insta-link" href="https://www.instagram.com/ashish_singh_rajput_3" target="_blank">@ashish_singh_rajput_3</a>
    </footer>
  </div>

  <script>
    // --- TEMPLATE DATA ---
    const templates = {
      bank_teller: {
        queueModel: 'M/M/c',
        businessType: 'bank',
        timeUnit: 'minutes',
        arrivalRate: 15,
        serviceRate: 8,
        serverCount: 3,
        systemCapacity: 50,
        serviceVariance: 1,
        waitingCost: 0.25,
        serviceLevelTarget: 95,
        acceptableWaitTime: 3,
        serverCost: 25
      },
      call_center: {
        queueModel: 'M/M/c',
        businessType: 'call_center',
        timeUnit: 'minutes',
        arrivalRate: 45,
        serviceRate: 12,
        serverCount: 5,
        systemCapacity: 100,
        serviceVariance: 1,
        waitingCost: 0.50,
        serviceLevelTarget: 90,
        acceptableWaitTime: 2,
        serverCost: 20
      },
      restaurant: {
        queueModel: 'M/M/1/K',
        businessType: 'restaurant',
        timeUnit: 'minutes',
        arrivalRate: 8,
        serviceRate: 10,
        serverCount: 1,
        systemCapacity: 25,
        serviceVariance: 1,
        waitingCost: 0.75,
        serviceLevelTarget: 85,
        acceptableWaitTime: 10,
        serverCost: 15
      },
      hospital_er: {
        queueModel: 'M/G/1',
        businessType: 'healthcare',
        timeUnit: 'minutes',
        arrivalRate: 4,
        serviceRate: 6,
        serverCount: 1,
        systemCapacity: 30,
        serviceVariance: 2.5,
        waitingCost: 2.00,
        serviceLevelTarget: 98,
        acceptableWaitTime: 15,
        serverCost: 75
      },
      drive_thru: {
        queueModel: 'M/M/1/K',
        businessType: 'restaurant',
        timeUnit: 'minutes',
        arrivalRate: 25,
        serviceRate: 30,
        serverCount: 1,
        systemCapacity: 12,
        serviceVariance: 1,
        waitingCost: 0.40,
        serviceLevelTarget: 92,
        acceptableWaitTime: 4,
        serverCost: 12
      }
    };

    // --- VALIDATION FUNCTIONS ---
    function validateInput(elementId, validator, errorMessage) {
      const element = document.getElementById(elementId);
      const inputGroup = element.closest('.input-group');
      const errorElement = inputGroup?.querySelector('.validation-error');
      
      if (!validator(element.value)) {
        inputGroup?.classList.add('error');
        if (errorElement) errorElement.textContent = errorMessage;
        return false;
      } else {
        inputGroup?.classList.remove('error');
        return true;
      }
    }

    function validateAllInputs() {
      let isValid = true;
      
      // Validate arrival rate
      isValid &= validateInput('arrivalRate', 
        val => parseFloat(val) > 0, 
        'Must be greater than 0');
      
      // Validate service rate
      const arrivalRate = parseFloat(document.getElementById('arrivalRate').value);
      const serverCount = parseInt(document.getElementById('serverCount').value) || 1;
      isValid &= validateInput('serviceRate', 
        val => parseFloat(val) > 0 && parseFloat(val) * serverCount > arrivalRate, 
        'Total service capacity must exceed arrival rate');
      
      // Validate server count
      isValid &= validateInput('serverCount', 
        val => parseInt(val) >= 1 && parseInt(val) <= 20, 
        'Must be between 1 and 20');
      
      // Validate other fields
      isValid &= validateInput('systemCapacity', 
        val => parseInt(val) > 0, 
        'Must be greater than 0');
      
      isValid &= validateInput('serviceVariance', 
        val => parseFloat(val) >= 0, 
        'Must be non-negative');
      
      isValid &= validateInput('waitingCost', 
        val => parseFloat(val) >= 0, 
        'Must be non-negative');
      
      isValid &= validateInput('serviceLevelTarget', 
        val => parseFloat(val) >= 50 && parseFloat(val) <= 99.9, 
        'Must be between 50% and 99.9%');
      
      isValid &= validateInput('acceptableWaitTime', 
        val => parseFloat(val) >= 0, 
        'Must be non-negative');
      
      isValid &= validateInput('serverCost', 
        val => parseFloat(val) >= 0, 
        'Must be non-negative');
      
      return isValid;
    }

    // Add real-time validation
    document.addEventListener('DOMContentLoaded', function() {
      const inputs = document.querySelectorAll('input[type="number"]');
      inputs.forEach(input => {
        input.addEventListener('blur', validateAllInputs);
        input.addEventListener('input', function() {
          // Clear error state on input
          const inputGroup = this.closest('.input-group');
          inputGroup?.classList.remove('error');
        });
      });
    });

    function loadTemplate(type) {
      const template = templates[type];
      if (!template) return;
      
      // Add loading animation
      const btn = event.target.closest('.btn');
      const originalContent = btn.innerHTML;
      btn.innerHTML = '<div class="loading-spinner"></div>Loading...';
      btn.disabled = true;
      
      setTimeout(() => {
        Object.keys(template).forEach(key => {
          const element = document.getElementById(key);
          if (element) {
            element.value = template[key];
          }
        });
        
        updateFormVisibility();
        btn.innerHTML = originalContent;
        btn.disabled = false;
        showToast(`${type.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())} template loaded!`, 'success');
      }, 500);
    }

    // Update form visibility based on queue model
    document.getElementById('queueModel').onchange = updateFormVisibility;

    function updateFormVisibility() {
      const model = document.getElementById('queueModel').value;
      const serverGroup = document.getElementById('serverCountGroup');
      const capacityGroup = document.getElementById('capacityGroup');
      const varianceGroup = document.getElementById('varianceGroup');
      
      // Show/hide server count
      if (model.includes('/c')) {
        serverGroup.style.display = '';
      } else {
        serverGroup.style.display = 'none';
        document.getElementById('serverCount').value = 1;
      }
      
      // Show/hide capacity
      if (model.includes('/K')) {
        capacityGroup.style.display = '';
      } else {
        capacityGroup.style.display = 'none';
      }
      
      // Show/hide variance
      if (model === 'M/G/1') {
        varianceGroup.style.display = '';
      } else {
        varianceGroup.style.display = 'none';
      }
    }

    // --- QUEUING CALCULATIONS ---
    
    function calculateQueue() {
      if (!validateAllInputs()) {
        showToast('Please fix the validation errors before calculating!', 'error');
        return;
      }

      // Add loading state
      const btn = document.getElementById('calculateBtn');
      const originalContent = btn.innerHTML;
      btn.innerHTML = '<div class="loading-spinner"></div>Calculating...';
      btn.disabled = true;

      // Get input values
      const model = document.getElementById('queueModel').value;
      const lambda = parseFloat(document.getElementById('arrivalRate').value) || 0;
      const mu = parseFloat(document.getElementById('serviceRate').value) || 0;
      const c = parseInt(document.getElementById('serverCount').value) || 1;
      const K = parseInt(document.getElementById('systemCapacity').value) || Infinity;
      const variance = parseFloat(document.getElementById('serviceVariance').value) || 1;
      const waitingCost = parseFloat(document.getElementById('waitingCost').value) || 0;
      const serviceLevelTarget = parseFloat(document.getElementById('serviceLevelTarget').value) || 95;
      const acceptableWaitTime = parseFloat(document.getElementById('acceptableWaitTime').value) || 5;
      const serverCost = parseFloat(document.getElementById('serverCost').value) || 25;

      setTimeout(() => {
        let results;
        
        try {
          switch (model) {
            case 'M/M/1':
              results = calculateMM1(lambda, mu, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost);
              break;
            case 'M/M/c':
              results = calculateMMc(lambda, mu, c, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost);
              break;
            case 'M/M/1/K':
              results = calculateMM1K(lambda, mu, K, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost);
              break;
            case 'M/M/c/K':
              results = calculateMMcK(lambda, mu, c, K, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost);
              break;
            case 'M/G/1':
              results = calculateMG1(lambda, mu, variance, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost);
              break;
            default:
              throw new Error('Invalid queue model selected!');
          }

          if (!results.stable) {
            showToast('Warning: Queue system is unstable (ρ ≥ 1)!', 'warning');
          }

          displayResults(results, model);
        } catch (error) {
          showToast(`Error: ${error.message}`, 'error');
        } finally {
          btn.innerHTML = originalContent;
          btn.disabled = false;
        }
      }, 1000); // Simulate calculation time
    }

    function calculateMM1(lambda, mu, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost) {
      const rho = lambda / mu;
      const stable = rho < 1;
      
      if (!stable) {
        return {
          stable: false,
          rho: rho,
          L: Infinity,
          Lq: Infinity,
          W: Infinity,
          Wq: Infinity,
          P0: 0,
          serviceLevel: 0,
          totalCost: Infinity
        };
      }
      
      const P0 = 1 - rho;
      const L = rho / (1 - rho);
      const Lq = (rho * rho) / (1 - rho);
      const W = 1 / (mu - lambda);
      const Wq = lambda / (mu * (mu - lambda));
      
      // Service level calculation (probability of wait time ≤ acceptable)
      const serviceLevel = (1 - Math.exp(-mu * acceptableWaitTime * (1 - rho))) * 100;
      
      // Cost calculation
      const totalWaitingCost = Lq * waitingCost * 60; // per hour
      const totalServerCost = 1 * serverCost; // per hour
      const totalCost = totalWaitingCost + totalServerCost;
      
      return {
        stable,
        rho,
        L,
        Lq,
        W,
        Wq,
        P0,
        serviceLevel,
        totalCost,
        totalWaitingCost,
        totalServerCost,
        servers: 1
      };
    }

    function calculateMMc(lambda, mu, c, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost) {
      const rho = lambda / (c * mu);
      const stable = rho < 1;
      
      if (!stable) {
        return {
          stable: false,
          rho: rho,
          L: Infinity,
          Lq: Infinity,
          W: Infinity,
          Wq: Infinity,
          P0: 0,
          serviceLevel: 0,
          totalCost: Infinity
        };
      }
      
      // Calculate P0 for M/M/c
      let sum = 0;
      for (let n = 0; n < c; n++) {
        sum += Math.pow(lambda/mu, n) / factorial(n);
      }
      const lastTerm = Math.pow(lambda/mu, c) / (factorial(c) * (1 - rho));
      const P0 = 1 / (sum + lastTerm);
      
      // Calculate Lq for M/M/c
      const Lq = (Math.pow(lambda/mu, c) * rho) / (factorial(c) * Math.pow(1 - rho, 2)) * P0;
      const Wq = Lq / lambda;
      const W = Wq + 1/mu;
      const L = lambda * W;
      
      // Service level calculation (approximate)
      const C = (Math.pow(lambda/mu, c) * P0) / (factorial(c) * (1 - rho)); // Erlang C formula
      const serviceLevel = (1 - C * Math.exp(-c * mu * acceptableWaitTime * (1 - rho))) * 100;
      
      // Cost calculation
      const totalWaitingCost = Lq * waitingCost * 60; // per hour
      const totalServerCost = c * serverCost; // per hour
      const totalCost = totalWaitingCost + totalServerCost;
      
      return {
        stable,
        rho,
        L,
        Lq,
        W,
        Wq,
        P0,
        serviceLevel,
        totalCost,
        totalWaitingCost,
        totalServerCost,
        servers: c
      };
    }

    function calculateMM1K(lambda, mu, K, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost) {
      const rho = lambda / mu;
      
      let P0, effectiveLambda;
      
      if (Math.abs(rho - 1) < 0.001) { // rho ≈ 1
        P0 = 1 / (K + 1);
      } else {
        P0 = (1 - rho) / (1 - Math.pow(rho, K + 1));
      }
      
      const PK = P0 * Math.pow(rho, K);
      effectiveLambda = lambda * (1 - PK);
      
      let L, Lq;
      if (Math.abs(rho - 1) < 0.001) { // rho ≈ 1
        L = K / 2;
      } else {
        L = rho * (1 - (K + 1) * Math.pow(rho, K) + K * Math.pow(rho, K + 1)) / ((1 - rho) * (1 - Math.pow(rho, K + 1)));
      }
      
      Lq = L - effectiveLambda / mu;
      const W = L / effectiveLambda;
      const Wq = Lq / effectiveLambda;
      
      // Service level calculation
      const serviceLevel = Math.min(95, (1 - PK) * 100); // Simplified
      
      // Cost calculation
      const totalWaitingCost = Lq * waitingCost * 60; // per hour
      const totalServerCost = 1 * serverCost; // per hour
      const totalCost = totalWaitingCost + totalServerCost;
      
      return {
        stable: true,
        rho: effectiveLambda / mu,
        L,
        Lq,
        W,
        Wq,
        P0,
        serviceLevel,
        totalCost,
        totalWaitingCost,
        totalServerCost,
        servers: 1,
        effectiveLambda,
        PK
      };
    }

    function calculateMMcK(lambda, mu, c, K, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost) {
      // For M/M/c/K, we use a simplified approach based on M/M/c with capacity adjustments
      const baseResult = calculateMMc(lambda, mu, c, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost);
      
      if (!baseResult.stable) {
        return baseResult;
      }
      
      // Capacity factor to adjust for finite capacity
      const capacityFactor = Math.min(1, K / Math.max(baseResult.L, 1));
      
      return {
        ...baseResult,
        L: baseResult.L * capacityFactor,
        Lq: baseResult.Lq * capacityFactor,
        W: baseResult.W * capacityFactor,
        Wq: baseResult.Wq * capacityFactor,
        serviceLevel: Math.min(baseResult.serviceLevel, 95), // Reduced due to capacity constraint
        totalCost: baseResult.totalWaitingCost * capacityFactor + baseResult.totalServerCost,
        totalWaitingCost: baseResult.totalWaitingCost * capacityFactor
      };
    }

    function calculateMG1(lambda, mu, variance, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost) {
      const rho = lambda / mu;
      const stable = rho < 1;
      
      if (!stable) {
        return {
          stable: false,
          rho: rho,
          L: Infinity,
          Lq: Infinity,
          W: Infinity,
          Wq: Infinity,
          P0: 0,
          serviceLevel: 0,
          totalCost: Infinity
        };
      }
      
      const P0 = 1 - rho;
      
      // Pollaczek-Khinchine formula
      const Lq = (Math.pow(lambda, 2) * variance + Math.pow(rho, 2)) / (2 * (1 - rho));
      const Wq = Lq / lambda;
      const W = Wq + 1/mu;
      const L = lambda * W;
      
      // Service level calculation (approximate)
      const serviceLevel = Math.max(50, 100 - Wq * 10); // Simplified approximation
      
      // Cost calculation
      const totalWaitingCost = Lq * waitingCost * 60; // per hour
      const totalServerCost = 1 * serverCost; // per hour
      const totalCost = totalWaitingCost + totalServerCost;
      
      return {
        stable,
        rho,
        L,
        Lq,
        W,
        Wq,
        P0,
        serviceLevel,
        totalCost,
        totalWaitingCost,
        totalServerCost,
        servers: 1
      };
    }

    function factorial(n) {
      if (n <= 1) return 1;
      let result = 1;
      for (let i = 2; i <= n; i++) {
        result *= i;
      }
      return result;
    }

    function displayResults(results, model) {
      // Determine status
      let status = 'stable';
      let statusText = '✅ Stable System';
      let statusIcon = 'fa-check-circle';
      
      if (!results.stable) {
        status = 'unstable';
        statusText = '❌ Unstable System';
        statusIcon = 'fa-times-circle';
      } else if (results.rho > 0.9) {
        status = 'critical';
        statusText = '⚠️ High Utilization';
        statusIcon = 'fa-exclamation-triangle';
      }

      // Show metrics cards with enhanced animations
      const metricsHtml = `
        <div class="result-card wait-time">
          <div class="result-value">${results.stable ? results.Wq.toFixed(2) : '∞'}</div>
          <div class="result-label">Average Wait Time</div>
          <div class="result-sublabel">Time in queue (${document.getElementById('timeUnit').value})</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${Math.min(results.Wq * 10, 100)}%"></div>
          </div>
        </div>
        <div class="result-card queue-length">
          <div class="result-value">${results.stable ? results.Lq.toFixed(2) : '∞'}</div>
          <div class="result-label">Average Queue Length</div>
          <div class="result-sublabel">Customers waiting</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${Math.min(results.Lq * 5, 100)}%"></div>
          </div>
        </div>
        <div class="result-card utilization">
          <div class="result-value">${(results.rho * 100).toFixed(1)}%</div>
          <div class="result-label">System Utilization</div>
          <div class="result-sublabel">Server busy time</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${results.rho * 100}%"></div>
          </div>
        </div>
        <div class="result-card efficiency">
          <div class="result-value">${results.stable ? results.serviceLevel.toFixed(1) : '0'}%</div>
          <div class="result-label">Service Level</div>
          <div class="result-sublabel">Within target time</div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${results.serviceLevel}%"></div>
          </div>
        </div>
      `;
      document.getElementById('metricsGrid').innerHTML = metricsHtml;

      // Show enhanced status
      document.getElementById('queueStatus').innerHTML = `
        <div class="queue-status ${status}">
          <i class="fa-solid ${statusIcon}"></i>
          ${statusText} | Traffic Intensity (ρ) = ${results.rho.toFixed(3)}
          ${results.stable ? '' : ' | System requires more servers or reduced arrival rate'}
        </div>
      `;

      // Generate table and chart
      generateQueueTable(results, model);
      generateQueueChart(results);
      
      // Show results section with smooth animation
      const resultsSection = document.getElementById('resultsSection');
      resultsSection.style.display = '';
      resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      
      showToast('Queue analysis completed successfully!', 'success');
    }

    function generateQueueTable(results, model) {
      const timeUnit = document.getElementById('timeUnit').value;
      
      const tableRows = `
        <tr>
          <th><i class="fa-solid fa-cog"></i> Performance Metric</th>
          <th><i class="fa-solid fa-calculator"></i> Value</th>
          <th><i class="fa-solid fa-ruler"></i> Unit</th>
          <th><i class="fa-solid fa-info-circle"></i> Description</th>
        </tr>
        <tr>
          <td><strong>Queue Model</strong></td>
          <td><span class="feature-tag">${model}</span></td>
          <td>-</td>
          <td>Kendall notation classification</td>
        </tr>
        <tr>
          <td><strong>Traffic Intensity (ρ)</strong></td>
          <td>${results.rho.toFixed(4)}</td>
          <td>ratio</td>
          <td>System utilization ratio</td>
        </tr>
        <tr>
          <td><strong>Average Wait Time (Wq)</strong></td>
          <td>${results.stable ? results.Wq.toFixed(3) : '∞'}</td>
          <td>${timeUnit}</td>
          <td>Expected time in queue</td>
        </tr>
        <tr>
          <td><strong>Average System Time (W)</strong></td>
          <td>${results.stable ? results.W.toFixed(3) : '∞'}</td>
          <td>${timeUnit}</td>
          <td>Total time in system</td>
        </tr>
        <tr>
          <td><strong>Average Queue Length (Lq)</strong></td>
          <td>${results.stable ? results.Lq.toFixed(3) : '∞'}</td>
          <td>customers</td>
          <td>Expected customers waiting</td>
        </tr>
        <tr>
          <td><strong>Average System Length (L)</strong></td>
          <td>${results.stable ? results.L.toFixed(3) : '∞'}</td>
          <td>customers</td>
          <td>Expected customers in system</td>
        </tr>
        <tr>
          <td><strong>Idle Probability (P₀)</strong></td>
          <td>${(results.P0 * 100).toFixed(2)}%</td>
          <td>probability</td>
          <td>System empty probability</td>
        </tr>
        <tr>
          <td><strong>Service Level</strong></td>
          <td>${results.serviceLevel.toFixed(2)}%</td>
          <td>percentage</td>
          <td>Served within target time</td>
        </tr>
        <tr>
          <td><strong>Total Cost</strong></td>
          <td>$${results.stable ? results.totalCost.toFixed(2) : '∞'}</td>
          <td>per hour</td>
          <td>Waiting + server costs</td>
        </tr>
        <tr>
          <td><strong>Number of Servers</strong></td>
          <td>${results.servers}</td>
          <td>servers</td>
          <td>Active service channels</td>
        </tr>
      `;
      
      document.getElementById('queueTable').innerHTML = tableRows;
    }

    let queueChart = null;
    function generateQueueChart(results) {
      if (queueChart) queueChart.destroy();
      
      const ctx = document.getElementById('queueChart').getContext('2d');
      
      if (!results.stable) {
        // Show unstable system indicator
        queueChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['Unstable System'],
            datasets: [{
              data: [100],
              backgroundColor: ['#ef4444'],
              borderWidth: 2,
              borderColor: '#1f2937'
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              title: { 
                display: true, 
                text: 'System Status: UNSTABLE (ρ ≥ 1)',
                color: '#ef4444',
                font: { size: 18, weight: 'bold' }
              }
            },
            animation: {
              animateRotate: true,
              duration: 2000
            }
          }
        });
        return;
      }
      
      // Show enhanced cost breakdown
      queueChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Waiting Costs', 'Server Costs', 'Idle Time Cost'],
          datasets: [{
            data: [
              results.totalWaitingCost || 0,
              results.totalServerCost || 0,
              (results.P0 * results.totalServerCost) || 0
            ],
            backgroundColor: [
              '#6366f1',
              '#f59e0b',
              '#8b5cf6'
            ],
            borderWidth: 3,
            borderColor: '#1f2937',
            hoverBorderWidth: 5
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { 
              labels: { 
                color: '#c6dbfa',
                font: { size: 14 }
              },
              position: 'bottom'
            },
            title: { 
              display: true, 
              text: 'Cost Breakdown Analysis (per hour)',
              color: '#c6dbfa',
              font: { size: 18, weight: 'bold' }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.parsed;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = ((value / total) * 100).toFixed(1);
                  return `${context.label}: $${value.toFixed(2)} (${percentage}%)`;
                }
              }
            }
          },
          animation: {
            animateRotate: true,
            duration: 1500
          }
        }
      });
    }

    function optimizeServers() {
      if (!validateAllInputs()) {
        showToast('Please fix validation errors first!', 'error');
        return;
      }

      const lambda = parseFloat(document.getElementById('arrivalRate').value) || 0;
      const mu = parseFloat(document.getElementById('serviceRate').value) || 0;
      const waitingCost = parseFloat(document.getElementById('waitingCost').value) || 0;
      const serverCost = parseFloat(document.getElementById('serverCost').value) || 25;
      const serviceLevelTarget = parseFloat(document.getElementById('serviceLevelTarget').value) || 95;
      const acceptableWaitTime = parseFloat(document.getElementById('acceptableWaitTime').value) || 5;

      const scenarios = [];
      const minServers = Math.ceil(lambda / mu) + 1; // Minimum for stability
      const maxServers = Math.min(minServers + 10, 15); // Check reasonable range

      for (let c = minServers; c <= maxServers; c++) {
        const result = calculateMMc(lambda, mu, c, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost);
        scenarios.push({
          servers: c,
          ...result,
          name: `${c} Server${c > 1 ? 's' : ''}`
        });
      }

      // Find optimal (minimum total cost)
      const validScenarios = scenarios.filter(s => s.stable);
      if (validScenarios.length === 0) {
        showToast('No stable server configurations found!', 'error');
        return;
      }

      const optimal = validScenarios.reduce((best, current) => 
        current.totalCost < best.totalCost ? current : best
      );

      displayServerOptimization(scenarios, optimal);
    }

    function displayServerOptimization(scenarios, optimal) {
      const optimizationHtml = scenarios.map(scenario => `
        <div class="scenario-card ${scenario === optimal ? 'best' : ''}">
          <div class="scenario-title">
            ${scenario.name} 
            ${scenario === optimal ? '🏆 OPTIMAL' : ''}
          </div>
          <div><strong>Total Cost:</strong> $${scenario.stable ? scenario.totalCost.toFixed(2) : '∞'}/hr</div>
          <div><strong>Wait Time:</strong> ${scenario.stable ? scenario.Wq.toFixed(2) : '∞'} min</div>
          <div><strong>Queue Length:</strong> ${scenario.stable ? scenario.Lq.toFixed(2) : '∞'}</div>
          <div><strong>Utilization:</strong> ${(scenario.rho * 100).toFixed(1)}%</div>
          <div><strong>Service Level:</strong> ${scenario.serviceLevel.toFixed(1)}%</div>
          <div><strong>Status:</strong> ${scenario.stable ? '✅ Stable' : '❌ Unstable'}</div>
        </div>
      `).join('');
      
      document.getElementById('optimizationGrid').innerHTML = optimizationHtml;
      document.getElementById('optimizationSection').style.display = '';
      
      generateOptimizationChart(scenarios.filter(s => s.stable));
      showToast(`Server optimization completed! Optimal: ${optimal.servers} servers`, 'success');
    }

    let optimizationChart = null;
    function generateOptimizationChart(scenarios) {
      if (optimizationChart) optimizationChart.destroy();
      
      const ctx = document.getElementById('optimizationChart').getContext('2d');
      
      optimizationChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: scenarios.map(s => s.servers),
          datasets: [
            {
              label: 'Total Cost ($/hr)',
              data: scenarios.map(s => s.totalCost),
              borderColor: '#6366f1',
              backgroundColor: '#6366f155',
              pointRadius: 6,
              pointHoverRadius: 8,
              borderWidth: 3,
              tension: 0.4,
              fill: true
            },
            {
              label: 'Wait Time (min)',
              data: scenarios.map(s => s.Wq),
              borderColor: '#f59e0b',
              backgroundColor: '#f59e0b55',
              pointRadius: 6,
              pointHoverRadius: 8,
              borderWidth: 3,
              tension: 0.4,
              yAxisID: 'y1'
            },
            {
              label: 'Utilization (%)',
              data: scenarios.map(s => s.rho * 100),
              borderColor: '#22c55e',
              backgroundColor: '#22c55e55',
              pointRadius: 6,
              pointHoverRadius: 8,
              borderWidth: 3,
              tension: 0.4,
              yAxisID: 'y2'
            }
          ]
        },
        options: {
          responsive: true,
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            legend: { 
              labels: { color: '#c6dbfa', font: { size: 14 } },
              position: 'top'
            },
            title: { 
              display: true, 
              text: 'Server Optimization: Multi-Objective Analysis',
              color: '#c6dbfa',
              font: { size: 18, weight: 'bold' }
            }
          },
          scales: {
            x: { 
              title: { display: true, text: 'Number of Servers', color: '#9ca3af', font: { size: 14 } },
              ticks: { color: '#9ca3af' },
              grid: { color: '#374151' }
            },
            y: { 
              title: { display: true, text: 'Total Cost ($/hr)', color: '#9ca3af', font: { size: 14 } },
              ticks: { color: '#9ca3af' },
              grid: { color: '#374151' }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: { display: true, text: 'Wait Time (min)', color: '#9ca3af', font: { size: 14 } },
              ticks: { color: '#9ca3af' },
              grid: { drawOnChartArea: false }
            },
            y2: {
              type: 'linear',
              display: false,
              position: 'right'
            }
          },
          animation: {
            duration: 2000,
            easing: 'easeInOutCubic'
          }
        }
      });
    }

    function sensitivityAnalysis() {
      if (!validateAllInputs()) {
        showToast('Please fix validation errors first!', 'error');
        return;
      }

      const baseLambda = parseFloat(document.getElementById('arrivalRate').value) || 0;
      const baseMu = parseFloat(document.getElementById('serviceRate').value) || 0;
      const c = parseInt(document.getElementById('serverCount').value) || 1;
      const waitingCost = parseFloat(document.getElementById('waitingCost').value) || 0;
      const serverCost = parseFloat(document.getElementById('serverCost').value) || 25;
      const serviceLevelTarget = parseFloat(document.getElementById('serviceLevelTarget').value) || 95;
      const acceptableWaitTime = parseFloat(document.getElementById('acceptableWaitTime').value) || 5;

      const scenarios = [
        { 
          name: 'Low Demand (-30%)', 
          lambda: baseLambda * 0.7, 
          mu: baseMu,
          description: '30% reduction in arrival rate',
          icon: '📉'
        },
        { 
          name: 'Low Demand (-20%)', 
          lambda: baseLambda * 0.8, 
          mu: baseMu,
          description: '20% reduction in arrival rate',
          icon: '📊'
        },
        { 
          name: 'Current Scenario', 
          lambda: baseLambda, 
          mu: baseMu,
          description: 'Current baseline scenario',
          icon: '📊'
        },
        { 
          name: 'High Demand (+20%)', 
          lambda: baseLambda * 1.2, 
          mu: baseMu,
          description: '20% increase in arrival rate',
          icon: '📈'
        },
        { 
          name: 'Peak Demand (+50%)', 
          lambda: baseLambda * 1.5, 
          mu: baseMu,
          description: 'Peak period traffic surge',
          icon: '🚀'
        },
        { 
          name: 'Improved Service (+25%)', 
          lambda: baseLambda, 
          mu: baseMu * 1.25,
          description: 'Service rate improvement',
          icon: '⚡'
        }
      ];

      const results = scenarios.map(scenario => {
        const model = document.getElementById('queueModel').value;
        let result;
        
        try {
          if (model === 'M/M/1') {
            result = calculateMM1(scenario.lambda, scenario.mu, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost);
          } else {
            result = calculateMMc(scenario.lambda, scenario.mu, c, waitingCost, serviceLevelTarget, acceptableWaitTime, serverCost);
          }
        } catch (error) {
          result = { stable: false, totalCost: Infinity, Wq: Infinity, rho: Infinity };
        }
        
        return {
          ...scenario,
          ...result
        };
      });

      // Find best and worst scenarios
      const validResults = results.filter(r => r.stable && r.totalCost !== Infinity);
      
      if (validResults.length === 0) {
        showToast('No stable scenarios found in sensitivity analysis!', 'warning');
        return;
      }

      const best = validResults.reduce((best, current) => 
        current.totalCost < best.totalCost ? current : best
      );
      const worst = validResults.reduce((worst, current) => 
        current.totalCost > worst.totalCost ? current : worst
      );

      displaySensitivityAnalysis(results, best, worst);
    }

    function displaySensitivityAnalysis(scenarios, best, worst) {
      const sensitivityHtml = scenarios.map(scenario => {
        let cardClass = '';
        if (scenario === best) cardClass = 'best';
        else if (scenario === worst) cardClass = 'worst';
        
        return `
          <div class="scenario-card ${cardClass}">
            <div class="scenario-title">
              ${scenario.icon} ${scenario.name} 
              ${scenario === best ? '🏆 BEST' : scenario === worst ? '⚠️ WORST' : ''}
            </div>
            <div><strong>Status:</strong> ${scenario.stable ? '✅ Stable' : '❌ Unstable'}</div>
            <div><strong>Utilization:</strong> ${scenario.stable ? (scenario.rho * 100).toFixed(1) : '∞'}%</div>
            <div><strong>Wait Time:</strong> ${scenario.stable ? scenario.Wq.toFixed(2) : '∞'} min</div>
            <div><strong>Queue Length:</strong> ${scenario.stable ? scenario.Lq.toFixed(2) : '∞'}</div>
            <div><strong>Total Cost:</strong> $${scenario.stable ? scenario.totalCost.toFixed(2) : '∞'}/hr</div>
            <div style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary); font-style: italic;">
              ${scenario.description}
            </div>
          </div>
        `;
      }).join('');
      
      document.getElementById('sensitivityGrid').innerHTML = sensitivityHtml;
      document.getElementById('sensitivitySection').style.display = '';
      
      generateSensitivityChart(scenarios.filter(s => s.stable));
      showToast('Sensitivity analysis completed successfully!', 'success');
    }

    let sensitivityChart = null;
    function generateSensitivityChart(scenarios) {
      if (sensitivityChart) sensitivityChart.destroy();
      
      const ctx = document.getElementById('sensitivityChart').getContext('2d');
      
      sensitivityChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: scenarios.map(s => s.name),
          datasets: [
            {
              label: 'Wait Time (min)',
              data: scenarios.map(s => s.Wq),
              backgroundColor: '#6366f1',
              borderColor: '#4f46e5',
              borderWidth: 2,
              borderRadius: 4
            },
            {
              label: 'Queue Length',
              data: scenarios.map(s => s.Lq),
              backgroundColor: '#8b5cf6',
              borderColor: '#7c3aed',
              borderWidth: 2,
              borderRadius: 4
            },
            {
              label: 'Total Cost ($/hr)',
              data: scenarios.map(s => s.totalCost),
              backgroundColor: '#f59e0b',
              borderColor: '#d97706',
              borderWidth: 2,
              borderRadius: 4,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { 
              labels: { color: '#c6dbfa', font: { size: 14 } },
              position: 'top'
            },
            title: { 
              display: true, 
              text: 'Sensitivity Analysis: Impact of Parameter Changes',
              color: '#c6dbfa',
              font: { size: 18, weight: 'bold' }
            }
          },
          scales: {
            x: { 
              ticks: { 
                color: '#9ca3af',
                maxRotation: 45,
                minRotation: 45
              },
              grid: { color: '#374151' }
            },
            y: { 
              title: { display: true, text: 'Wait Time & Queue Length', color: '#9ca3af', font: { size: 14 } },
              ticks: { color: '#9ca3af' },
              grid: { color: '#374151' }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: { display: true, text: 'Total Cost ($/hr)', color: '#9ca3af', font: { size: 14 } },
              ticks: { color: '#9ca3af' },
              grid: { drawOnChartArea: false }
            }
          },
          animation: {
            duration: 1500,
            easing: 'easeInOutCubic'
          }
        }
      });
    }

    function exportResults() {
      if (document.getElementById('resultsSection').style.display === 'none') {
        showToast('No results to export! Please run analysis first.', 'error');
        return;
      }
      
      try {
        // Create detailed CSV content
        let csv = 'Queue Analysis Results Report\n';
        csv += `Generated on: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}\n\n`;
        
        // Add parameters section
        csv += 'INPUT PARAMETERS\n';
        csv += '================\n';
        csv += `Queue Model,${document.getElementById('queueModel').value}\n`;
        csv += `Business Type,${document.getElementById('businessType').value}\n`;
        csv += `Time Unit,${document.getElementById('timeUnit').value}\n`;
        csv += `Arrival Rate (λ),${document.getElementById('arrivalRate').value}\n`;
        csv += `Service Rate (μ),${document.getElementById('serviceRate').value}\n`;
        csv += `Number of Servers,${document.getElementById('serverCount').value}\n`;
        csv += `System Capacity,${document.getElementById('systemCapacity').value}\n`;
        csv += `Service Variance,${document.getElementById('serviceVariance').value}\n`;
        csv += `Waiting Cost ($/unit),${document.getElementById('waitingCost').value}\n`;
        csv += `Service Level Target (%),${document.getElementById('serviceLevelTarget').value}\n`;
        csv += `Acceptable Wait Time,${document.getElementById('acceptableWaitTime').value}\n`;
        csv += `Server Cost ($/hour),${document.getElementById('serverCost').value}\n\n`;
        
        // Add results section
        csv += 'PERFORMANCE METRICS\n';
        csv += '===================\n';
        const table = document.getElementById('queueTable');
        if (table) {
          const rows = table.querySelectorAll('tr');
          rows.forEach(row => {
            const cols = row.querySelectorAll('td, th');
            const rowData = Array.from(cols).map(col => col.textContent.trim().replace(/,/g, ';')).join(',');
            csv += rowData + '\n';
          });
        }
        
        // Add recommendations
        csv += '\nRECOMMENDations\n';
        csv += '===============\n';
        csv += 'Based on the analysis, consider the following:\n';
        csv += '- Monitor system utilization to ensure it stays below 90%\n';
        csv += '- Implement queue management strategies during peak hours\n';
        csv += '- Consider service process improvements if wait times exceed targets\n';
        csv += '- Regular review of staffing levels based on demand patterns\n';
        
        // Download CSV
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `queue_analysis_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showToast('Queue analysis exported successfully!', 'success');
      } catch (error) {
        showToast('Error exporting results. Please try again.', 'error');
      }
    }

    function resetForm() {
      // Show confirmation dialog
      if (!confirm('Are you sure you want to reset all inputs and clear results?')) {
        return;
      }

      // Reset form fields to defaults
      document.getElementById('queueModel').value = 'M/M/1';
      document.getElementById('businessType').value = 'bank';
      document.getElementById('timeUnit').value = 'minutes';
      document.getElementById('arrivalRate').value = '20';
      document.getElementById('serviceRate').value = '25';
      document.getElementById('serverCount').value = '1';
      document.getElementById('systemCapacity').value = '50';
      document.getElementById('serviceVariance').value = '1';
      document.getElementById('waitingCost').value = '0.50';
      document.getElementById('serviceLevelTarget').value = '95';
      document.getElementById('acceptableWaitTime').value = '5';
      document.getElementById('serverCost').value = '25';
      
      // Clear validation errors
      document.querySelectorAll('.input-group').forEach(group => {
        group.classList.remove('error');
      });
      
      // Hide result sections
      document.getElementById('resultsSection').style.display = 'none';
      document.getElementById('optimizationSection').style.display = 'none';
      document.getElementById('sensitivitySection').style.display = 'none';
      
      // Destroy charts
      if (queueChart) {
        queueChart.destroy();
        queueChart = null;
      }
      if (optimizationChart) {
        optimizationChart.destroy();
        optimizationChart = null;
      }
      if (sensitivityChart) {
        sensitivityChart.destroy();
        sensitivityChart = null;
      }
      
      // Update form visibility
      updateFormVisibility();
      
      showToast('Form reset successfully!', 'success');
    }

    function showToast(msg, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.className = `toast ${type}`;
      toast.style.display = 'block';
      
      // Auto-hide after 4 seconds
      setTimeout(() => { 
        toast.style.display = 'none'; 
      }, 4000);
    }

    // Initialize form when page loads
    document.addEventListener('DOMContentLoaded', function() {
      updateFormVisibility();
      
      // Add keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'Enter':
              e.preventDefault();
              calculateQueue();
              break;
            case 'r':
              e.preventDefault();
              resetForm();
              break;
            case 's':
              e.preventDefault();
              exportResults();
              break;
          }
        }
      });
      
      // Add tooltips for better UX
      const tooltips = {
        'arrivalRate': 'Average number of customers arriving per time unit',
        'serviceRate': 'Average number of customers that can be served per time unit',
        'serverCount': 'Number of parallel service channels available',
        'systemCapacity': 'Maximum number of customers the system can hold',
        'serviceVariance': 'Variability in service times (used in M/G/1 model)',
        'waitingCost': 'Cost associated with each customer waiting per time unit',
        'serviceLevelTarget': 'Desired percentage of customers served within acceptable time',
        'acceptableWaitTime': 'Maximum wait time considered acceptable',
        'serverCost': 'Hourly operational cost per server'
      };
      
      Object.keys(tooltips).forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.title = tooltips[id];
        }
      });
    });
  </script>


            <script></script>
        
    
</body><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration>
